---
groups:
  - name: alerts
    rules:
      - alert: MAASIPExhaustionCritical
        expr: maas_net_subnet_ip_count{status="available"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
            summary: "{{ $labels.cidr }} has exhausted all IPs"
            description: The subnet has no more IPs to allocate

      - alert: MAASIPExhaustionWarning
        expr: maas_net_subnet_ip_count{status="available"} < 5
        for: 1m
        labels:
          severity: warn
        annotations:
          summary: "{{ $labels.cidr }} is getting low on available IPs"
          description: The subnet is close to exhausting all IPs

      - alert: MAASLXDFetchMachineFailure
        expr: count(maas_lxd_fetch_machine_failure) > 0
        for: 0m
        labels:
          severity: error
        annotations:
          summary: MAAS has failed to fetch a machine's info from LXD
          description: MAAS has encountered an error with LXD while fetching a machine's info

      - alert: MAASLXDDiskCreationFailure
        expr: count(maas_lxd_disk_creation_failure) > 0
        for: 0m
        labels:
          severity: error
        annotations:
          summary: MAAS has failed to create a disk via LXD
          description: MAAS has encountered an error with LXD while attempting to create a disk

      - alert: MAASVirshFetchMACFailure
        expr: count(maas_virsh_fetch_mac_failure) > 0
        for: 0m
        labels:
          severity: error
        annotations:
          summary: MAAS has failed to fetch a MAC address from Virsh for a machine
          description: MAAS has failed to communicate with a Virsh hypervisor in order to fetch a MAC address for a machine

      - alert: MAASVirshMachineDescriptionFetchFailure
        expr: count(maas_virsh_fetch_description_failure) > 0
        for: 0m
        labels:
          severity: error
        annotations:
          summary: MAAS has failed to fetch a machine's description from Virsh
          description: MAAS has failed to communicate with a Virsh hypervisor while fetching a machine's description

      - alert: MAASVirshStoragePoolCreationFailure
        expr: count(maas_virsh_storage_pool_creation_failure) > 0
        for: 0m
        labels:
          severity: critical
        annotations:
          summary: MAAS has failed to create a Virsh storage pool
          description: MAAS was unable to create a storage pool for a Virsh hypervisor
